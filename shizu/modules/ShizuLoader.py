#    Sh1t-UB (telegram userbot by sh1tn3t)
#    Copyright (C) 2021-2022 Sh1tN3t

#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.

#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.

#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.

# ‚ñà ‚ñà‚ÄÉ‚ñà‚ÄÉ‚ñà‚ñÑ‚ñÄ‚ÄÉ‚ñÑ‚ñÄ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñÑ‚ñÄ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñà‚ÄÉ‚ñà ‚ñà
# ‚ñà‚ñÄ‚ñà‚ÄÉ‚ñà‚ÄÉ‚ñà ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñà‚ÄÉ‚ñà ‚ñÄ ‚ñà‚ÄÉ‚ñà‚ñÑ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñÑ‚ÄÉ‚ñà‚ñÑ‚ñà

# üîí Licensed under the GNU GPLv3
# üåê https://www.gnu.org/licenses/agpl-3.0.html
# üë§ https://t.me/hikamoru


import atexit
import logging
import os
import re
import sys
import time
from typing import List

import requests
from pyrogram import Client, enums, types

from .. import loader, utils

VALID_URL = r"[-[\]_.~:/?#@!$&'()*+,;%<=>a-zA-Z0-9]+"

VALID_PIP_PACKAGES = re.compile(
    r"^\s*# required:(?: ?)((?:{url} )*(?:{url}))\s*$".format(url=VALID_URL),
    re.MULTILINE,
)
GIT_REGEX = re.compile(
    r"^https?://github\.com((?:/[a-z0-9-]+){2})(?:/tree/([a-z0-9-]+)((?:/[a-z0-9-]+)*))?/?$",
    flags=re.IGNORECASE,
)

logger = logging.getLogger(__name__)


@loader.module(name="ShizuLoader", author="shizu")
class Loader(loader.Module):
    """Mainly used to load modules"""

    strings = {
        "invalid_repo": "‚ùå Invalid repository link.\n",
        "no_all": "‚ùå The all.txt file was not found in the <a href='{}'>repository</a>.\n",
        "mods_in_repo": "{} <b>List of available modules in <a href='{}'>repository</a></b>:\n\n",
        "check": "<emoji id=5280506417478903827>üõ°</emoji> Analyzing the module..",
        "found_delete_": "<emoji id=5203929938024999176>üõ°</emoji> <b><u>Shizu</u> protected your account from</b> <code>DeleteAccount</code>.\n<emoji id=5404380425416090434>‚ÑπÔ∏è</emoji> <b>This module contains a dangerous code that can delete your account.</b>",
        "dep_installed_req_res": "‚úÖ Dependencies are installed. Reboot required",
        "not_module": "‚ùå Failed to load the module. See the logs for details",
        "inc_link": "‚ùå The link is incorrect",
        "not_aw_by_link": "‚ùå The module is not available by the link",
        "unex_error": "‚ùå An unexpected error has occurred. See the logs for details",
        "loaded": (
            "<emoji id=5267468588985363056>‚úîÔ∏è</emoji> Module <b>{}</b> loaded\n"
            "<emoji id=5787544344906959608>‚ÑπÔ∏è</emoji>  {} \n\n"
        ),
        "repo_set": "‚úÖ Repository has been set",
        "no_repy_to_file": "‚ùå No reply to file",
        "loading": "<emoji id=5215493819641895305>üöõ</emoji> <b>Loading the module..</b>",
        "core_do": "‚ùå It is not allowed to load core modules",
        "inc_module_name": "‚ùå Incorrect module name",
        "core_unload": "<emoji id=5364241851500997604>‚ö†Ô∏è</emoji> You cannot unload the core modules",
        "unloaded": "<emoji id=6334471265700546607>üßπ</emoji> Module <code>{}</code> unloaded",
        "spec_action": "<emoji id=5188420746694633417>üåó</emoji> <b>Specify the action</b>",
        "not_for_this_account": "<emoji id=5352726898151534058>üò¢</emoji> <b>This module is not available for this account</b>",
        "all_unloaded": "<emoji id=6334471265700546607>üßπ</emoji> All modules unloaded",
        "restart": "<b><emoji id=5328274090262275771>üîÅ</emoji> Restarting...</b>",
        "only_telethon": "<b><emoji id=5818764548080930127>‚õ∞</emoji>You have not enabled Telethon mode, thus it is not possible to use this module</b>",
        "specify_to_block": "ü´¶ <b>Specify the module to ban. (reply or link)</b>",
        "module_banned": "<emoji id=5258011861273551368>üåò</emoji> <b>Module <code>{}</code> banned the next time you cannot load it</b>",
        "loaded_banned": "<emoji id=5418159410646099061>üö´</emoji> <b>Hey, hey, hey, you have banned this module, you cannot load it</b>",
        "no_banned": "<emoji id=5839434146912407382>üö´</emoji> <b>There are no banned modules</b>",
        "banned_list": "<emoji id=5780471598922337683>üåç</emoji> <b>Heres a list of banned modules:</b>\n\n {}",
        "specify_to_unblock": "ü´¶ <b>Specify the module to unblock.</b>",
        "unblocked": "<emoji id=5418159410646099061>üö´</emoji> <b>Module <code>{}</code> unblocked</b>",
    }

    strings_ru = {
        "invalid_repo": "‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.\n",
        "no_all": "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ all.txt –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ <a href='{}'>repository</a>.\n",
        "mods_in_repo": "{} <b>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –≤ <a href='{}'>repository</a></b>:\n\n",
        "check": "<emoji id=5280506417478903827>üõ°</emoji> –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª—è..",
        "found_delete_": "<emoji id=5203929938024999176>üõ°</emoji> <b><u>Shizu</u> –∑–∞—â–∏—Ç–∏–ª –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –æ—Ç</b> <code>DeleteAccount</code>.\n<emoji id=5404380425416090434>‚ÑπÔ∏è</emoji> <b>–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∞—Å–Ω—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç.</b>",
        "dep_installed_req_res": "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è",
        "not_module": "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏",
        "inc_link": "‚ùå –°—Å—ã–ª–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞",
        "not_aw_by_link": "‚ùå –ú–æ–¥—É–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ",
        "unex_error": "‚ùå –û—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏",
        "loaded": (
            "<emoji id=5267468588985363056>‚úîÔ∏è</emoji> –ú–æ–¥—É–ª—å <b>{}</b> –∑–∞–≥—Ä—É–∂–µ–Ω\n"
            "<emoji id=5787544344906959608>‚ÑπÔ∏è</emoji> {} \n\n"
        ),
        "repo_set": "‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",
        "no_repy_to_file": "‚ùå –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Ñ–∞–π–ª",
        "loading": "<emoji id=5215493819641895305>üöõ</emoji> <b>–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è..</b>",
        "core_do": "‚ùå –ù–µ–ª—å–∑—è –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏",
        "inc_module_name": "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –º–æ–¥—É–ª—è",
        "core_unload": "<emoji id=5364241851500997604>‚ö†Ô∏è</emoji> –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ ",
        "unloaded": "<emoji id=6334471265700546607>üßπ</emoji> –ú–æ–¥—É–ª—å <code>{}</code> –≤—ã–≥—Ä—É–∂–µ–Ω",
        "spec_action": "<emoji id=5188420746694633417>üåó</emoji> <b>–£–∫–∞–∂–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</b>",
        "not_for_this_account": "<emoji id=5352726898151534058>üò¢</emoji> <b>–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</b>",
        "all_unloaded": "<emoji id=6334471265700546607>üßπ</emoji> –í—Å–µ –º–æ–¥—É–ª–∏ –≤—ã–≥—Ä—É–∂–µ–Ω—ã",
        "restart": "<b><emoji id=5328274090262275771>üîÅ</emoji> –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫...</b>",
        "only_telethon": "<b><emoji id=5818764548080930127>‚õ∞</emoji>–í—ã –Ω–µ –≤–∫–ª—é—á–∏–ª–∏ –¢–µ–ª–µ—Ç–æ–Ω –º–æ–¥, –ø–æ—ç—Ç–æ–º—É –æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</b>",
        "specify_to_block": "ü´¶ <b>–£–∫–∞–∂–∏—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏. (–æ—Ç–≤–µ—Ç –∏–ª–∏ —Å—Å—ã–ª–∫–∞)</b>",
        "module_banned": "<emoji id=5258011861273551368>üåò</emoji> <b>–ú–æ–¥—É–ª—å <code>{}</code> –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –µ–≥–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å</b>",
        "loaded_banned": "<emoji id=5418159410646099061>üö´</emoji> <b>–≠–π, —ç–π, —ç–π, –≤—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ —ç—Ç–æ—Ç –º–æ–¥—É–ª—å, –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –µ–≥–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å</b>",
        "no_banned": "<emoji id=5839434146912407382>üö´</emoji> <b>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –Ω–µ—Ç</b>",
        "banned_list": "<emoji id=5780471598922337683>üåç</emoji> <b>–í–æ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:</b>\n\n {}",
        "specify_to_unblock": "ü´¶ <b>–£–∫–∞–∂–∏—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.</b>",
        "unblocked": "<emoji id=5418159410646099061>üö´</emoji> <b>–ú–æ–¥—É–ª—å <code>{}</code> —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</b>",
    }

    strings_uz = {
        "invalid_repo": "‚ùå Xatolik yuz berdi.\n",
        "no_all": "‚ùå All.txt fayl mavjud emas <a href='{}'>repository</a>.\n",
        "mods_in_repo": "{} <b>Modullar ro'yhati <a href='{}'>repository</a></b>:\n\n",
        "check": "<emoji id=5280506417478903827>üõ°</emoji> Modul tekshirilmoqda..",
        "found_delete_": "<emoji id=5203929938024999176>üõ°</emoji> <b><u>Shizu</u> DeleteAccount dan hisobingizni himoya qildi</b> <code>DeleteAccount</code>.\n<emoji id=5404380425416090434>‚ÑπÔ∏è</emoji> <b>Bu modul hisobingizni o'chirishi mumkin bo'lgan xavfsizlik kodi bor.</b>",
        "dep_installed_req_res": "‚úÖ Zarrashilmoqda. Userbotni qayta yuklash kerak",
        "not_module": "‚ùå Modul yuklanmadi. Loglaridan foydalaning",
        "inc_link": "‚ùå Link xato",
        "not_aw_by_link": "‚ùå Modul mavjud emas",
        "unex_error": "‚ùå Xatolik. Loglaridan foydalaning",
        "loaded": (
            "<emoji id=5267468588985363056>‚úîÔ∏è</emoji> Modul <b>{}</b> yuklandi\n"
            "<emoji id=5787544344906959608>‚ÑπÔ∏è</emoji> {} \n\n"
        ),
        "repo_set": "‚úÖ Repository yuklandi",
        "no_repy_to_file": "‚ùå Faylni reply qiliing",
        "loading": "<emoji id=5215493819641895305>üöõ</emoji> <b>Modul yuklanmoqda..</b>",
        "core_do": "‚ùå Userbotni modullarini yuklash mumkun emas",
        "inc_module_name": "‚ùå Module nomi xato",
        "core_unload": "<emoji id=5364241851500997604>‚ö†Ô∏è</emoji> Bu modulni userbotdan yuklanmaydi",
        "unloaded": "<emoji id=6334471265700546607>üßπ</emoji> Modul <code>{}</code> ochirildi",
        "spec_action": "<emoji id=5188420746694633417>üåó</emoji> <b>Nma qilishim kerak?</b>",
        "not_for_this_account": "<emoji id=5352726898151534058>üò¢</emoji> <b>Bu modul ushbu akkaunt uchun mavjud emas</b>",
        "all_unloaded": "<emoji id=6334471265700546607>üßπ</emoji> Barcha modullar ochirildi",
        "restart": "<b><emoji id=5328274090262275771>üîÅ</emoji> Qayta ishlayapti...</b>",
        "only_telethon": "<b><emoji id=5818764548080930127>‚õ∞</emoji>Telethon mod ishlatilmadi shuning uchun modul zagruzka bolmadi</b>",
        "specify_to_block": "ü´¶ <b>Blocklash uchun modulni ko'rsating. (reply yoki link)</b>",
        "module_banned": "<emoji id=5258011861273551368>üåò</emoji> <b>Modul <code>{}</code> bloklandi, keyinroq uni yuklab bo'lmaydi</b>",
        "loaded_banned": "<emoji id=5418159410646099061>üö´</emoji> <b>Hey, hey, hey, siz bu modulni blokladingiz, uni yuklab bo'lmaydi</b>",
        "no_banned": "<emoji id=5839434146912407382>üö´</emoji> <b>Bloklangan modullar yo'q</b>",
        "banned_list": "<emoji id=5780471598922337683>üåç</emoji> <b>Bloklangan modullar ro'yhati:</b>\n\n {}",
        "specify_to_unblock": "ü´¶ <b>Unblocklash uchun modulni ko'rsating.</b>",
        "unblocked": "<emoji id=5418159410646099061>üö´</emoji> <b>Modul <code>{}</code> unblocklandi</b>",
    }

    strings_jp = {
        "invalid_repo": "‚ùå ÁÑ°Âäπ„Å™„É™„Éù„Ç∏„Éà„É™.\n",
        "no_all": "‚ùå all.txt„Éï„Ç°„Ç§„É´„Åå<a href='{}'>repository</a>„Å´Ë¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü.\n",
        "mods_in_repo": "{} <b>„É™„Éù„Ç∏„Éà„É™„ÅÆÂà©Áî®ÂèØËÉΩ„Å™„É¢„Ç∏„É•„Éº„É´„ÅÆ„É™„Çπ„Éà <a href='{}'>repository</a></b>:\n\n",
        "check": "<emoji id=5280506417478903827>üõ°</emoji> „É¢„Ç∏„É•„Éº„É´„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„ÅÑ„Åæ„Åô..",
        "found_delete_": "<emoji id=5203929938024999176>üõ°</emoji> <b><u>Shizu</u> „ÅÇ„Å™„Åü„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà„Çí‰øùË≠∑„Åó„Åæ„Åó„Åü</b> <code>DeleteAccount</code>.\n<emoji id=5404380425416090434>‚ÑπÔ∏è</emoji> <b>„Åì„ÅÆ„É¢„Ç∏„É•„Éº„É´„Å´„ÅØ„ÄÅ„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíÂâäÈô§„Åô„ÇãÂèØËÉΩÊÄß„ÅÆ„ÅÇ„ÇãÂç±Èô∫„Å™„Ç≥„Éº„Éâ„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ</b>",
        "dep_installed_req_res": "‚úÖ ‰æùÂ≠òÈñ¢‰øÇ„Åå„Ç§„É≥„Çπ„Éà„Éº„É´„Åï„Çå„Åæ„Åó„Åü„ÄÇÂÜçËµ∑Âãï„ÅåÂøÖË¶Å„Åß„Åô",
        "not_module": "‚ùå „É¢„Ç∏„É•„Éº„É´„Çí„É≠„Éº„Éâ„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇË©≥Á¥∞„Å´„Å§„ÅÑ„Å¶„ÅØ„É≠„Ç∞„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
        "inc_link": "‚ùå „É™„É≥„ÇØ„ÅåÁÑ°Âäπ„Åß„Åô",
        "not_aw_by_link": "‚ùå „É¢„Ç∏„É•„Éº„É´„ÅØ„É™„É≥„ÇØ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì",
        "unex_error": "‚ùå ‰∫àÊúü„Åó„Å™„ÅÑ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇË©≥Á¥∞„Å´„Å§„ÅÑ„Å¶„ÅØ„É≠„Ç∞„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
        "loaded": (
            "<emoji id=5267468588985363056>‚úîÔ∏è</emoji> „É¢„Ç∏„É•„Éº„É´ <b>{}</b> „É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„Åü\n"
            "<emoji id=5787544344906959608>‚ÑπÔ∏è</emoji>  {} \n\n"
        ),
        "repo_set": "‚úÖ „É™„Éù„Ç∏„Éà„É™„ÅåË®≠ÂÆö„Åï„Çå„Åæ„Åó„Åü",
        "no_repy_to_file": "‚ùå „Éï„Ç°„Ç§„É´„Å´Ëøî‰ø°„Åó„Å™„ÅÑ",
        "loading": "<emoji id=5215493819641895305>üöõ</emoji> <b>„É¢„Ç∏„É•„Éº„É´„Çí„É≠„Éº„Éâ„Åó„Å¶„ÅÑ„Åæ„Åô..</b>",
        "core_do": "‚ùå „Ç≥„Ç¢„É¢„Ç∏„É•„Éº„É´„Çí„É≠„Éº„Éâ„Åô„Çã„Åì„Å®„ÅØË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì",
        "inc_module_name": "‚ùå „É¢„Ç∏„É•„Éº„É´Âêç„ÅåÁÑ°Âäπ„Åß„Åô",
        "core_unload": "<emoji id=5364241851500997604>‚ö†Ô∏è</emoji> „Ç≥„Ç¢„É¢„Ç∏„É•„Éº„É´„Çí„Ç¢„É≥„É≠„Éº„Éâ„Åô„Çã„Åì„Å®„ÅØ„Åß„Åç„Åæ„Åõ„Çì",
        "unloaded": "<emoji id=6334471265700546607>üßπ</emoji> „É¢„Ç∏„É•„Éº„É´ <code>{}</code> „Ç¢„É≥„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„Åü",
        "spec_action": "<emoji id=5188420746694633417>üåó</emoji> <b>„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</b>",
        "not_for_this_account": "<emoji id=5352726898151534058>üò¢</emoji> <b>„Åì„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„ÅØ„Åì„ÅÆ„É¢„Ç∏„É•„Éº„É´„ÅØÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì</b>",
        "all_unloaded": "<emoji id=6334471265700546607>üßπ</emoji> „Åô„Åπ„Å¶„ÅÆ„É¢„Ç∏„É•„Éº„É´„Åå„Ç¢„É≥„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„Åü",
        "restart": "<b><emoji id=5328274090262275771>üîÅ</emoji> ÂÜçËµ∑Âãï„Åó„Å¶„ÅÑ„Åæ„Åô...</b>",
        "only_telethon": "<b><emoji id=5818764548080930127>‚õ∞</emoji>„ÉÜ„É¨„ÇΩ„É≥„É¢„Éº„Éâ„ÅåÊúâÂäπ„Å´„Å™„Å£„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Åì„ÅÆ„É¢„Ç∏„É•„Éº„É´„Çí‰ΩøÁî®„Åô„Çã„Åì„Å®„ÅØ„Åß„Åç„Åæ„Åõ„Çì</b>",
        "specify_to_block": "ü´¶ <b>„Éñ„É≠„ÉÉ„ÇØ„Åô„Çã„É¢„Ç∏„É•„Éº„É´„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ (Ëøî‰ø°„Åæ„Åü„ÅØ„É™„É≥„ÇØ)</b>",
        "module_banned": "<emoji id=5258011861273551368>üåò</emoji> <b>„É¢„Ç∏„É•„Éº„É´ <code>{}</code> Ê¨°Âõû„ÅØ„É≠„Éº„Éâ„Åß„Åç„Åæ„Åõ„Çì</b>",
        "loaded_banned": "<emoji id=5418159410646099061>üö´</emoji> <b>„Éò„Ç§„ÄÅ„Éò„Ç§„ÄÅ„Éò„Ç§„ÄÅ„Åì„ÅÆ„É¢„Ç∏„É•„Éº„É´„Çí„Éñ„É≠„ÉÉ„ÇØ„Åó„Åæ„Åó„Åü„ÄÅ„É≠„Éº„Éâ„Åô„Çã„Åì„Å®„ÅØ„Åß„Åç„Åæ„Åõ„Çì</b>",
        "no_banned": "<emoji id=5839434146912407382>üö´</emoji> <b>„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åü„É¢„Ç∏„É•„Éº„É´„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</b>",
        "banned_list": "<emoji id=5780471598922337683>üåç</emoji> <b>„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åü„É¢„Ç∏„É•„Éº„É´„ÅÆ„É™„Çπ„Éà„Åß„Åô:</b>\n\n {}",
        "specify_to_unblock": "ü´¶ <b>„Éñ„É≠„ÉÉ„ÇØËß£Èô§„Åô„Çã„É¢„Ç∏„É•„Éº„É´„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</b>",
        "unblocked": "<emoji id=5418159410646099061>üö´</emoji> <b>„É¢„Ç∏„É•„Éº„É´ <code>{}</code> „Éñ„É≠„ÉÉ„ÇØËß£Èô§„Åï„Çå„Åæ„Åó„Åü</b>",
    }

    strings_ua = {
        "invalid_repo": "‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π.\n",
        "no_all": "‚ùå all.txt —Ñ–∞–π–ª –Ω–µ –∑–Ω–∞–∏ÃÜ–¥–µ–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ñÃà <a href='{}'>repository</a>.\n",
        "mods_in_repo": "{} <b>–ú–æ–¥—É–ª—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é <a href='{}'>repository</a></b>:\n\n",
        "check": "<emoji id=5280506417478903827>üõ°</emoji> –ê–Ω–∞–ª—ñ–∑ –º–æ–¥—É–ª—è..",
        "loaded": "<emoji id=5267468588985363056>‚úîÔ∏è</emoji> –ú–æ–¥—É–ª—å <b>{}</b> –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ\n"
        "<emoji id=5787544344906959608>‚ÑπÔ∏è</emoji> {} \n\n",
        "repo_set": "‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ",
        "unloaded": "<emoji id=6334471265700546607>üßπ</emoji> –ú–æ–¥—É–ª—å <code>{}</code> –≤–∏–ª—É—á–µ–Ω–æ",
        "spec_action": "<emoji id=5188420746694633417>üåó</emoji> <b>–ê–∫—Ü—ñ—é –≤–∫–∞–∑–∞–Ω–æ</b>",
        "no_repy_to_file": "‚ùå –ù–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",
        "loading": "<emoji id=5215493819641895305>üöõ</emoji> <b>–ú–æ–¥—É–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è..</b>",
        "not_for_this_account": "<emoji id=5352726898151534058>üò¢</emoji> <b>–¶–µ–π –º–æ–¥—É–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è —Ü—å–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É</b>",
        "all_unloaded": "<emoji id=6334471265700546607>üßπ</emoji> –í—Å—ñ –º–æ–¥—É–ª—ñ –≤–∏–ª—É—á–µ–Ω–æ",
        "restart": "<b><emoji id=5328274090262275771>üîÅ</emoji> –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</b>",
        "only_telethon": "<b><emoji id=5818764548080930127>‚õ∞</emoji>–í–∏ –Ω–µ –≤–∫–ª—é—á–∏–ª–∏ –¢–µ–ª–µ—Ç–æ–Ω –º–æ–¥, —Ç–æ–º—É –≤—ñ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π</b>",
        "specify_to_block": "ü´¶ <b>–í–∫–∞–∂—ñ—Ç—å –º–æ–¥—É–ª—å –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è. (–≤—ñ–¥–ø–æ–≤—ñ–¥—å –∞–±–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è)</b>",
        "module_banned": "<emoji id=5258011861273551368>üåò</emoji> <b>–ú–æ–¥—É–ª—å <code>{}</code> –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ, –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É –≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –π–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</b>",
        "loaded_banned": "<emoji id=5418159410646099061>üö´</emoji> <b>–ï–π, –µ–π, –µ–π, –≤–∏ –∑–∞–±–ª–æ–∫—É–≤–∞–ª–∏ —Ü–µ–π –º–æ–¥—É–ª—å, –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –π–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</b>",
        "no_banned": "<emoji id=5839434146912407382>üö´</emoji> <b>–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤ –Ω–µ–º–∞—î</b>",
        "banned_list": "<emoji id=5780471598922337683>üåç</emoji> <b>–û—Å—å —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤:</b>\n\n {}",
        "specify_to_unblock": "ü´¶ <b>–í–∫–∞–∂—ñ—Ç—å –º–æ–¥—É–ª—å –¥–ª—è —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è.</b>",
        "unblocked": "<emoji id=5418159410646099061>üö´</emoji> <b>–ú–æ–¥—É–ª—å <code>{}</code> —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ</b>",
    }

    strings_kz = {
        "invalid_repo": "‚ùå –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∂–∞—Ä–∞–º—Å—ã–∑.\n",
        "no_all": "‚ùå all.txt —Ñ–∞–π–ª—ã–Ω —Ç–∞–±—ã–ª–º–∞–¥—ã <a href='{}'>repository</a>.\n",
        "mods_in_repo": "{} <b>–ú–æ–¥—É–ª—å–¥–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Å—ã <a href='{}'>repository</a></b>:\n\n",
        "check": "<emoji id=5280506417478903827>üõ°</emoji> –ú–æ–¥—É–ª—å–¥—ñ —Ç–µ–∫—Å–µ—Ä—É..",
        "loaded": "<emoji id=5267468588985363056>‚úîÔ∏è</emoji> –ú–æ–¥—É–ª—å <b>{}</b> –∂“Ø–∫—Ç–µ–ª–¥—ñ\n"
        "<emoji id=5787544344906959608>‚ÑπÔ∏è</emoji> {} \n\n",
        "repo_set": "‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ä–Ω–∞—Ç—ã–ª–¥—ã",
        "unloaded": "<emoji id=6334471265700546607>üßπ</emoji> –ú–æ–¥—É–ª—å <code>{}</code> –∂–æ–π—ã–ª–¥—ã",
        "spec_action": "<emoji id=5188420746694633417>üåó</emoji> <b>”ò—Ä–µ–∫–µ—Ç—Ç—ñ –∫”©—Ä—Å–µ—Ç—ñ“£—ñ–∑</b>",
        "no_repy_to_file": "‚ùå –§–∞–π–ª“ì–∞ –∂–∞—É–∞–ø –±–µ—Ä–º–µ—É",
        "loading": "<emoji id=5215493819641895305>üöõ</emoji> <b>–ú–æ–¥—É–ª—å –∂“Ø–∫—Ç–µ–ª—É–¥–µ..</b>",
        "not_for_this_account": "<emoji id=5352726898151534058>üò¢</emoji> <b>–ë“±–ª –º–æ–¥—É–ª—å –±“±–ª –∞–∫–∫–∞—É–Ω—Ç“õ–∞ “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –µ–º–µ—Å</b>",
        "all_unloaded": "<emoji id=6334471265700546607>üßπ</emoji> –ë–∞—Ä–ª—ã“õ –º–æ–¥—É–ª—å–¥–µ—Ä –∂–æ–π—ã–ª–¥—ã",
        "restart": "<b><emoji id=5328274090262275771>üîÅ</emoji> “ö–∞–π—Ç–∞ —ñ—Å–∫–µ “õ–æ—Å—É...</b>",
        "only_telethon": "<b><emoji id=5818764548080930127>‚õ∞</emoji>–¢–µ–ª–µ—Ç–æ–Ω –º–æ–¥—Ç—ã “õ–æ—Å–ø–∞“ì–∞–Ω—Å—ã–∑ —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω –æ–ª “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –µ–º–µ—Å</b>",
        "specify_to_block": "ü´¶ <b>–ë–ª–æ–∫—Ç–∞—É “Ø—à—ñ–Ω –º–æ–¥—É–ª—å–¥—ñ –∫”©—Ä—Å–µ—Ç—ñ“£—ñ–∑. (–∂–∞—É–∞–ø –Ω–µ–º–µ—Å–µ —Å—ñ–ª—Ç–µ–º–µ)</b>",
        "module_banned": "<emoji id=5258011861273551368>üåò</emoji> <b>–ú–æ–¥—É–ª—å <code>{}</code> –±–ª–æ–∫—Ç–∞–ª–¥—ã, –∫–µ–ª–µ—Å—ñ —Ä–µ—Ç –æ–Ω—ã –∂“Ø–∫—Ç–µ –∞–ª–º–∞–π—Å—ã–∑</b>",
        "loaded_banned": "<emoji id=5418159410646099061>üö´</emoji> <b>–≠–π, —ç–π, —ç–π, —Å—ñ–∑ –æ—Å—ã –º–æ–¥—É–ª—å–¥—ñ –±–ª–æ–∫—Ç–∞–¥—ã“£—ã–∑, –æ–Ω—ã –∂“Ø–∫—Ç–µ –∞–ª–º–∞–π—Å—ã–∑</b>",
        "no_banned": "<emoji id=5839434146912407382>üö´</emoji> <b>–ë–ª–æ–∫—Ç–∞–ª“ì–∞–Ω –º–æ–¥—É–ª—å–¥–µ—Ä –∂–æ“õ</b>",
        "banned_list": "<emoji id=5780471598922337683>üåç</emoji> <b>–ë–ª–æ–∫—Ç–∞–ª“ì–∞–Ω –º–æ–¥—É–ª—å–¥–µ—Ä —Ç—ñ–∑—ñ–º—ñ:</b>\n\n {}",
        "specify_to_unblock": "ü´¶ <b>–ë–ª–æ–∫—Ç–∞—É–¥—ã –±“±–∑—É “Ø—à—ñ–Ω –º–æ–¥—É–ª—å–¥—ñ –∫”©—Ä—Å–µ—Ç—ñ“£—ñ–∑.</b>",
        "unblocked": "<emoji id=5418159410646099061>üö´</emoji> <b>–ú–æ–¥—É–ª—å <code>{}</code> –±–ª–æ–∫—Ç–∞—É–¥—ã –±“±–∑—ã–ª–¥—ã</b>",
    }

    def __init__(self):
        self.config = loader.ModuleConfig(
            "repo",
            "https://github.com/AmoreForever/ShizuMods",
            "Repository link",
            "private_repo",
            None,
            "Private repository link",
            "private_token",
            None,
            "Private repository token",
        )

    @loader.command(aliases=['dlm'])
    async def dlmod(self, app: Client, message: types.Message, args: str):
        """Download module by link. Usage: dlmod <link or all or nothing>"""

        bot_username = (await self.bot.bot.get_me()).username
        dop_help = "<emoji id=5100652175172830068>‚ñ´Ô∏è</emoji>"
        modules_repo = self.config["repo"]
        private = self.config["private_repo"], self.config["private_token"]

        api_result = await self.get_git_raw_link(modules_repo)
        
        if not api_result:
            return await message.answer(self.strings("invalid_repo"))

        raw_link = api_result

        modules = await utils.run_sync(requests.get, f"{raw_link}all.txt")

        if modules.status_code != 200:
            return await message.answer(
                self.strings("no_all").format(raw_link), disable_web_page_preview=True
            )

        modules: List[str] = modules.text.splitlines()

        if self.config["private_repo"] and self.config["private_token"]:
            api_resultP = await self.get_git_raw_link(private[0], private[1])

            if not api_resultP:
                return await message.answer(self.strings("invalid_repo"))

            headers = {"Authorization": f"token {private[1]}"}

            modulesP = await utils.run_sync(
                requests.get, f"{api_resultP}all.txt", headers=headers
            )

            if modulesP.status_code != 200:
                return await message.answer(
                    self.strings("no_all").format(api_resultP),
                    disable_web_page_preview=True,
                )

            modulesP: List[str] = modulesP.text.splitlines()

        if not args:
            text = self.strings("mods_in_repo").format("üéç", modules_repo) + "\n".join(
                map("‚Ä¢ <code>{}</code>".format, modules)
            )

            if self.config["private_repo"] and self.config["private_token"]:
                textP = self.strings("mods_in_repo").format(
                    "ü´¶", private[0]
                ) + "\n".join(map("‚Ä¢ <code>{}</code>".format, modulesP))

                return await self.bot.list(
                    message,
                    [text, textP],
                    disable_web_page_preview=True,
                )

            return await message.answer(text, disable_web_page_preview=True)

        error_text: str = None
        module_name: str = None
        is_private = False

        if args in modules:
            args = raw_link + args + ".py"
            r = await utils.run_sync(requests.get, args)
            if r.status_code != 200:
                raise requests.exceptions.ConnectionError

            await message.answer(self.strings("check"))

            module_name = await self.all_modules.load_module(r.text, r.url)

        if self.config["private_repo"] and self.config["private_token"] and args in modulesP:
            args = api_resultP + args + ".py"
        
            headers = {"Authorization": f"token {private[1]}"}
        
            r = await utils.run_sync(requests.get, args, headers=headers)
        
            if r.status_code != 200:
                raise requests.exceptions.ConnectionError
        
            await message.answer(self.strings("check"))
        
            module_name = await self.all_modules.load_module(r.text, "<string>")
            is_private = True

        try:
            if module_name == "DAR":
                error_text = self.strings("found_delete_")
            if module_name == "NFA":
                error_text = self.strings("not_for_this_account")
            if module_name is True:
                error_text = self.strings("dep_installed_req_res")
            if not module_name:
                error_text = self.strings("not_module")

        except requests.exceptions.MissingSchema:
            error_text = self.strings("inc_link")
        except requests.exceptions.ConnectionError:
            error_text = self.strings("inc_link")
        except requests.exceptions.RequestException:
            error_text = self.strings("unex_error")

        if error_text:
            return await message.answer(error_text)

        if args in modules:
            self.db.set(
                "shizu.loader",
                "modules",
                list(set(self.db.get("shizu.loader", "modules", []) + [args])),
            )

        if is_private:
            with open(
                f"./shizu/modules/{module_name}.py", "w", encoding="utf-8"
            ) as file:
                file.write(r.text)

        if not (module := self.all_modules.get_module(module_name, True)):
            return await message.answer(
                "<b><emoji id=5465665476971471368>‚ùå</emoji> There is no such module</b>",
            )

        prefix = self.db.get("shizu.loader", "prefixes", ["."])[0]
        command_descriptions = "\n".join(
            f"{dop_help} <code>{prefix + command}</code> - {module.command_handlers[command].__doc__ or 'No description'}"
            for command in module.command_handlers
        )
        inline_descriptions = "\n".join(
            f"{dop_help} <code>@{bot_username} {command}</code> - {module.inline_handlers[command].__doc__ or 'No description'}"
            for command in module.inline_handlers
        )
        modname = str(module.name).capitalize()

        header = self.strings("loaded").format(
            modname, module.__doc__ or "No description"
        )
        footer = (
            f"<emoji id=5190458330719461749>üßë‚Äçüíª</emoji> <code>{module.author}</code>"
            if module.author
            else ""
        )
        return await message.answer(
            header + command_descriptions + "\n" + inline_descriptions + "\n" + footer,
        )

    async def get_git_raw_link(self, repo_url: str, token: str = None):
        
        match = GIT_REGEX.search(repo_url)
        if not match:
            return False

        repo_path, branch, path = match.group(1), match.group(2), match.group(3)

        if token:
            headers = {"Authorization": f"token {token}"}
            r = await utils.run_sync(
                requests.get,
                f"https://api.github.com/repos{repo_path}",
                headers=headers,
            )
        else:
            r = await utils.run_sync(
                requests.get, f"https://api.github.com/repos{repo_path}"
            )

        if r.status_code != 200:
            return False

        branch = branch or r.json().get("default_branch", "")

        return f"https://raw.githubusercontent.com{repo_path}/{branch}{path or ''}/"

    @loader.command(aliases=["lm"])
    async def loadmod(self, app: Client, message: types.Message):
        """Load the module by file. Usage: <replay per file>"""
        reply = message.reply_to_message
        bot_username = (await self.bot.bot.get_me()).username
        dop_help = (
            "<emoji id=5100652175172830068>üî∏</emoji>"
            if message.from_user.is_premium
            else "üî∏"
        )

        file = (
            message if message.document else reply if reply and reply.document else None
        )

        if not file:
            return await message.answer(self.strings("no_repy_to_file"))

        await message.answer(self.strings("loading"))
        file = await reply.download()

        for mod in self.cmodules:
            if file == mod:
                return await message.answer(self.strings("core_do"))

        try:
            with open(file, "r", encoding="utf-8") as file:
                module_source = file.read()

        except UnicodeDecodeError:
            return await message.answer("‚ùå Incorrect file encoding")
        await message.answer(self.strings("check"))

        module_name = await self.all_modules.load_module(module_source)
        if module_name is True:
            return await message.answer(self.strings("dep_installed_req_res"))

        if not module_name:
            return await message.answer(self.strings("not_module"))

        if module_name == "DAR":
            return await message.answer(self.strings("found_delete_"))

        if module_name == "NFA":
            return await message.answer(self.strings("not_for_this_account"))

        if module_name == "OTL":
            return await message.answer(self.strings("only_telethon"))

        if module_name == "BAN":
            return await message.answer(self.strings("loaded_banned"))

        module = "_".join(module_name.lower().split())
        with open(f"shizu/modules/{module}.py", "w", encoding="utf-8") as file:
            file.write(module_source)

        if not (module := self.all_modules.get_module(module_name, True)):
            return await message.answer(
                "<b><emoji id=5465665476971471368>‚ùå</emoji> There is no such module</b>",
            )

        prefix = self.db.get("shizu.loader", "prefixes", ["."])[0]
        command_descriptions = "\n".join(
            f"{dop_help} <code>{prefix + command}</code> - {module.command_handlers[command].__doc__ or 'No description'}"
            for command in module.command_handlers
        )
        inline_descriptions = "\n".join(
            f"{dop_help} <code>@{bot_username} {command}</code> - {module.inline_handlers[command].__doc__ or 'No description'}"
            for command in module.inline_handlers
        )
        modname = str(module.name).capitalize()

        header = self.strings("loaded").format(
            modname, module.__doc__ or "No description"
        )
        footer = (
            f"<emoji id=5190458330719461749>üßë‚Äçüíª</emoji> <code>{module.author}</code>"
            if module.author
            else ""
        )
        return await message.answer(
            header + command_descriptions + "\n" + inline_descriptions + "\n" + footer,
        )

    @loader.command()
    async def unloadmod(self, app: Client, message: types.Message, args: str):
        """Unload the module. Usage: unloadmod <module name>"""

        if not (module_name := self.all_modules.unload_module(args)):
            return await message.answer(self.strings("inc_module_name"))

        if module_name in self.cmodules:
            logging.error("You can't unload core modules")
            return await message.answer(self.strings("core_unload"))

        return await message.answer(self.strings("unloaded").format(module_name))

    @loader.command()
    async def unloadall(self, app: Client, message: types.Message):
        """Unload all modules"""

        self._local_modules_path: str = "./shizu/modules"

        self.db.set("shizu.loader", "modules", [])

        for local_module in filter(
            lambda file_name: file_name.endswith(".py")
            and not file_name.startswith("Shizu"),
            os.listdir(self._local_modules_path),
        ):
            os.remove(f"{self._local_modules_path}/{local_module}")

        await message.answer(self.strings("all_unloaded"))
        ms = await message.answer(self.strings("restart"))

        self.db.set(
            "shizu.updater",
            "restart",
            {
                "chat": message.chat.username
                if message.chat.type == enums.ChatType.BOT
                else message.chat.id,
                "id": ms.id,
                "start": time.time(),
                "type": "restart",
            },
        )

        atexit.register(os.execl(sys.executable, sys.executable, "-m", "shizu"))
        return sys.exit(0)

    @loader.command()
    async def banmodslist(self, app: Client, message: types.Message):
        """Show banned modules list"""

        modules = self.db.get("shizu.loader", "banned", [])

        if not modules:
            return await message.answer(self.strings("no_banned"))

        text = self.strings("banned_list").format(
            "\n".join(map("‚Ä¢ <code>{}</code>".format, modules))
        )

        return await message.answer(text)

    @loader.command()
    async def blockmodule(self, app: Client, message: types.Message):
        """It will block the module the next time u cannot load it"""

        reply = message.reply_to_message
        args = message.get_args_raw()

        if not reply and not args:
            return await message.answer(self.strings("spec_action"))

        if reply:
            file = (
                message
                if message.document
                else reply
                if reply and reply.document
                else None
            )

            source = await reply.download()

            with open(source, "r", encoding="utf-8") as file:
                module_source = file.read()

            module_name = await self.all_modules.load_module(
                module_source, only_ban=True
            )

            if not module_name:
                return await message.answer(self.strings("not_module"))

            await message.answer(self.strings("module_banned").format(module_name))

        if args:
            r = await utils.run_sync(requests.get, args)

            if r.status_code != 200:
                raise requests.exceptions.ConnectionError

            module_name = await self.all_modules.load_module(
                r.text, r.url, only_ban=True
            )

            if not module_name:
                return await message.answer(self.strings("not_module"))

            await message.answer(self.strings("module_banned").format(module_name))

    @loader.command()
    async def unblockmodule(self, app: Client, message: types.Message):
        """Unblock the module"""

        args = message.get_args_raw()

        if not args:
            return await message.answer(self.strings("specify_to_unblock"))

        if args in self.db.get("shizu.loader", "banned", []):
            self.db.set(
                "shizu.loader",
                "banned",
                list(set(self.db.get("shizu.loader", "banned", [])) - {args}),
            )
            return await message.answer(self.strings("unblocked").format(args))
